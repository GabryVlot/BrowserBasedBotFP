<head>
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <script src='js/fingerprint2.js'></script>
    <script>
        function fp(){
            const configuration = document.getElementById('txtConfDesc').value
            if (!configuration || configuration.length === 0){
                alert('Enter configuration description')
                return;
            }

            var fp = new Fingerprint2();
            fp.get(function (result, components) {
                console.log(result); //a hash, representing your device fingerprint
                console.log(components); // an array of FP components
                saveFP(result, components, configuration);
            });
        }

        function saveFP(hash, components, configuration){
            var http = new XMLHttpRequest();
            var url = "http://10.0.2.2:8080/api/save_fp";
            http.open("POST", url, true);

            const windowKeys = Object.keys(window);
            const docKeys = Object.keys(window.document);
            const navigatorKeys = Object.keys(window.navigator);

            console.log('@@', windowKeys.length, docKeys.length, navigatorKeys.length);

            const params = {
                "hash": hash,
                "fp": components,
                "configuration": configuration,
                "browser": {
                    window: windowKeys,
                    document: docKeys,
                    navigator: navigatorKeys
                }
            }

            //Send the proper header information along with the request
            http.setRequestHeader("Content-type", "application/json");


            http.onreadystatechange = function() {//Call a function when the state changes.
//                if(http.readyState == 4 && http.status == 200) {
//                    alert(http.responseText);
//                }
            }

            for (var i =0; i<components.length;i++){
                const entry = components[i];
                //if (entry.key === 'js_fonts')
                //    console.log('@@@FONts', entry.value);
            }

            console.log('send params', JSON.stringify(params.configuration, null, 4));
            http.send(JSON.stringify(params));
        }

    </script>
</head>

<div class="ext-box">
    <h1>Detection</h1>
    <div class="int-box">

        <div class="int-box">
            <label>Configuration description:</label>
            <input id="txtConfDesc" type="text" name="confDescr">
        </div>
        <button onclick="fp()" id="btnFP">Fingerprint Browser</button>

    </div>
</div>
